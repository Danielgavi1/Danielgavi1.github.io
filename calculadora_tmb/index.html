<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MetabolicPro Royal | Calculadora Premium</title>
    <link rel="icon" href="./img/MetabolicPro.png" type="image/x-icon">
    <!-- Fonts: Playfair Display for Headings, Manrope for UI -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700&family=Playfair+Display:wght@400;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Three.js for 3D Visualization -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="./script.js" defer></script>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar: Inputs -->
        <aside class="sidebar">
            <header class="sidebar-header">
                <div class="logo-wrapper">
                    <i class="fa-solid fa-crown logo-icon"></i>
                    <h1>MetabolicPro</h1>
                </div>
                <p class="tagline">Royal Edition</p>

                <div class="theme-toggle-wrapper">
                    <input type="checkbox" id="theme-toggle" class="theme-toggle" aria-label="Cambiar tema">
                    <label for="theme-toggle" class="theme-toggle-label">
                        <span class="icon sun-icon"><i class="fas fa-sun"></i></span>
                        <span class="icon moon-icon"><i class="fas fa-moon"></i></span>
                    </label>
                </div>
            </header>

            <form class="calculator-form" id="calculator-form">

                <!-- Personal Data Section -->
                <div class="form-section">
                    <h3><i class="fa-regular fa-user"></i> Datos Personales</h3>

                    <div class="grid-2-col">
                        <div class="input-group">
                            <label for="sexo">Sexo</label>
                            <div class="select-wrapper">
                                <select id="sexo">
                                    <option value="masculino">Hombre</option>
                                    <option value="femenino">Mujer</option>
                                </select>
                                <i class="fa-solid fa-chevron-down arrow-icon"></i>
                            </div>
                        </div>
                        <div class="input-group">
                            <label for="edad">Edad</label>
                            <input type="number" id="edad" placeholder="25" min="10" max="100">
                        </div>
                    </div>

                    <div class="grid-2-col">
                        <div class="input-group">
                            <label for="peso">Peso Actual (kg)</label>
                            <input type="number" id="peso" placeholder="70.5" min="30" max="300" step="0.1">
                        </div>
                        <div class="input-group">
                            <label for="peso-objetivo">Peso Meta (kg)</label>
                            <input type="number" id="peso-objetivo" placeholder="65" min="30" max="300" step="0.1">
                        </div>
                    </div>

                    <div class="input-group">
                        <label for="altura">Altura (cm)</label>
                        <input type="number" id="altura" placeholder="175" min="100" max="250">
                    </div>
                </div>

                <!-- Advanced Metrics Section -->
                <div class="form-section">
                    <h3><i class="fa-solid fa-chart-line"></i> M√©tricas Avanzadas</h3>

                    <div class="input-group">
                        <label for="actividad">Nivel de Actividad</label>
                        <div class="select-wrapper">
                            <select id="actividad">
                                <option value="1.2">Sedentario (Oficina, sin ejercicio)</option>
                                <option value="1.375">Ligero (1-3 d√≠as/sem)</option>
                                <option value="1.55">Moderado (3-5 d√≠as/sem)</option>
                                <option value="1.725">Activo (6-7 d√≠as/sem)</option>
                                <option value="1.9">Atleta (2x d√≠a, f√≠sico intenso)</option>
                            </select>
                            <i class="fa-solid fa-chevron-down arrow-icon"></i>
                        </div>
                    </div>

                    <div class="grid-2-col">
                        <div class="input-group">
                            <label for="grasa" class="optional-label">
                                % Grasa <span class="badge-opt">Opcional</span>
                                <span class="tooltip-icon" title="Necesario para la f√≥rmula Katch-McArdle"><i
                                        class="fa-solid fa-circle-info"></i></span>
                            </label>
                            <input type="number" id="grasa" placeholder="15" min="1" max="80" step="0.1">
                        </div>
                        <div class="input-group">
                            <label for="formula">F√≥rmula</label>
                            <div class="select-wrapper">
                                <select id="formula">
                                    <option value="mifflin">Mifflin-St Jeor (Est√°ndar)</option>
                                    <option value="harris">Harris-Benedict</option>
                                    <option value="katch">Katch-McArdle (Precisa)</option>
                                </select>
                                <i class="fa-solid fa-chevron-down arrow-icon"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Goal Section -->
                <div class="form-section">
                    <h3><i class="fa-solid fa-bullseye"></i> Estrategia Nutricional</h3>

                    <div class="input-group">
                        <label for="objetivo">Objetivo</label>
                        <div class="select-wrapper goal-select">
                            <select id="objetivo">
                                <option value="deficit_agresivo">üìâ D√©ficit Agresivo (-25%)</option>
                                <option value="deficit_moderado">üìâ D√©ficit Moderado (-20%)</option>
                                <option value="mantenimiento" selected>‚öñÔ∏è Mantenimiento</option>
                                <option value="superavit_ligero">üìà Volumen Limpio (+10%)</option>
                                <option value="superavit_agresivo">üöÄ Volumen Agresivo (+20%)</option>
                                <option value="custom">üõ†Ô∏è Personalizado</option>
                            </select>
                            <i class="fa-solid fa-chevron-down arrow-icon"></i>
                        </div>
                    </div>

                    <!-- Hidden by default: Custom Calories -->
                    <div class="input-group" id="custom-calories-group" style="display: none;">
                        <label for="calorias-custom">Meta de Calor√≠as Diarias</label>
                        <input type="number" id="calorias-custom" placeholder="Ej: 1800" min="500" max="10000">
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="button-group">
                    <button type="button" id="reset-btn" class="btn btn-secondary">
                        <i class="fa-solid fa-rotate-left"></i>
                    </button>
                    <!-- Note: Calculation is mostly automatic/reactive, but this provides explicit action -->
                    <button type="button" id="calculate-btn" class="btn btn-primary">
                        Calcular Plan
                    </button>
                </div>
            </form>
        </aside>

        <!-- Main Content: Dashboard -->
        <main class="dashboard" id="results-dashboard">
            <!-- Header for Mobile/Context -->
            <div class="dashboard-header-mobile">
                <h2>Tu Resumen Metab√≥lico</h2>
            </div>

            <!-- Top Cards: TMB & GET & IMC -->
            <section class="kpi-grid">
                <div class="kpi-card glass-card">
                    <div class="skeleton skeleton-circle hidden" id="skeleton-tmb-icon"></div>
                    <div class="kpi-icon" id="tmb-icon"><i class="fa-solid fa-fire"></i></div>
                    <div class="kpi-content">
                        <h4>
                            Metabolismo Basal (TMB)
                            <div class="tooltip-container">
                                <i class="fa-solid fa-circle-info tooltip-trigger"></i>
                                <div class="tooltip-content">
                                    <h5>TMB - Tasa Metab√≥lica Basal</h5>
                                    <p>Calor√≠as que tu cuerpo quema en reposo total para mantener funciones vitales como
                                        respiraci√≥n, circulaci√≥n y temperatura corporal.</p>
                                </div>
                            </div>
                        </h4>
                        <div class="skeleton skeleton-text large hidden" id="skeleton-tmb"></div>
                        <div class="kpi-value" id="tmb-value"><span id="tmb-output">--</span> <small>kcal</small></div>
                        <p class="kpi-desc">Energ√≠a en reposo absoluto</p>
                    </div>
                </div>

                <div class="kpi-card glass-card main-kpi">
                    <div class="skeleton skeleton-circle hidden" id="skeleton-get-icon"></div>
                    <div class="kpi-icon" id="get-icon"><i class="fa-solid fa-person-running"></i></div>
                    <div class="kpi-content">
                        <h4>
                            Gasto Total (GET)
                            <div class="tooltip-container">
                                <i class="fa-solid fa-circle-info tooltip-trigger"></i>
                                <div class="tooltip-content">
                                    <h5>GET - Gasto Energ√©tico Total</h5>
                                    <p>Calor√≠as totales que quemas al d√≠a incluyendo actividad f√≠sica. Es tu TMB
                                        multiplicado por tu nivel de actividad.</p>
                                </div>
                            </div>
                        </h4>
                        <div class="skeleton skeleton-text large hidden" id="skeleton-get"></div>
                        <div class="kpi-value highlight" id="get-value"><span id="get-output">--</span>
                            <small>kcal</small>
                        </div>
                        <p class="kpi-desc">Mantenimiento real diario</p>
                    </div>
                </div>

                <div class="kpi-card glass-card">
                    <div class="skeleton skeleton-circle hidden" id="skeleton-imc-icon"></div>
                    <div class="kpi-icon" id="imc-icon"><i class="fa-solid fa-weight-scale"></i></div>
                    <div class="kpi-content">
                        <h4>
                            IMC
                            <div class="tooltip-container">
                                <i class="fa-solid fa-circle-info tooltip-trigger"></i>
                                <div class="tooltip-content">
                                    <h5>IMC - √çndice de Masa Corporal</h5>
                                    <p>Relaci√≥n entre tu peso y altura. Nota: No considera masa muscular, es solo una
                                        referencia general.</p>
                                </div>
                            </div>
                        </h4>
                        <div class="skeleton skeleton-text large hidden" id="skeleton-imc"></div>
                        <div class="kpi-value" id="imc-value"><span id="imc-output">--</span></div>
                        <div class="status-badge" id="imc-classification">--</div>
                    </div>
                </div>
            </section>

            <!-- Target Calories & Macros -->
            <section class="target-section glass-card">
                <div class="section-header">
                    <h2><i class="fa-solid fa-crosshairs"></i> Meta Diaria</h2>
                    <div class="target-calories">
                        <span id="calories-output">--</span> kcal
                    </div>
                </div>

                <!-- Macros Grid -->
                <div class="macros-grid">
                    <div class="macro-item protein">
                        <div class="macro-header">
                            <span class="dot"></span> Prote√≠nas
                            <div class="tooltip-container">
                                <i class="fa-solid fa-circle-info tooltip-trigger"
                                    style="font-size: 0.75rem; margin-left: 4px;"></i>
                                <div class="tooltip-content">
                                    <h5>Prote√≠nas</h5>
                                    <p>Esenciales para mantener y construir m√∫sculo. 4 calor√≠as por gramo. Prioridad #1
                                        en d√©ficit.</p>
                                </div>
                            </div>
                        </div>
                        <div class="skeleton skeleton-text large hidden" id="skeleton-protein"></div>
                        <div class="macro-val" id="protein-val"><span id="protein-g">--</span>g</div>
                        <div class="skeleton skeleton-bar hidden" id="skeleton-protein-bar"></div>
                        <div class="macro-bar" id="protein-bar-container">
                            <div class="fill" style="width: 0%" id="protein-bar"></div>
                        </div>
                        <div class="macro-cal"><span id="protein-cals">--</span> kcal</div>
                    </div>

                    <div class="macro-item carbs">
                        <div class="macro-header">
                            <span class="dot"></span> Carbohidratos
                            <div class="tooltip-container">
                                <i class="fa-solid fa-circle-info tooltip-trigger"
                                    style="font-size: 0.75rem; margin-left: 4px;"></i>
                                <div class="tooltip-content">
                                    <h5>Carbohidratos</h5>
                                    <p>Energ√≠a principal para entrenamientos intensos. 4 calor√≠as por gramo. Aumenta en
                                        super√°vit.</p>
                                </div>
                            </div>
                        </div>
                        <div class="skeleton skeleton-text large hidden" id="skeleton-carbs"></div>
                        <div class="macro-val" id="carbs-val"><span id="carbs-g">--</span>g</div>
                        <div class="skeleton skeleton-bar hidden" id="skeleton-carbs-bar"></div>
                        <div class="macro-bar" id="carbs-bar-container">
                            <div class="fill" style="width: 0%" id="carbs-bar"></div>
                        </div>
                        <div class="macro-cal"><span id="carbs-cals">--</span> kcal</div>
                    </div>

                    <div class="macro-item fats">
                        <div class="macro-header">
                            <span class="dot"></span> Grasas
                            <div class="tooltip-container">
                                <i class="fa-solid fa-circle-info tooltip-trigger"
                                    style="font-size: 0.75rem; margin-left: 4px;"></i>
                                <div class="tooltip-content">
                                    <h5>Grasas</h5>
                                    <p>Vitales para hormonas y salud. 9 calor√≠as por gramo. No reducir por debajo de
                                        0.8g/kg.</p>
                                </div>
                            </div>
                        </div>
                        <div class="skeleton skeleton-text large hidden" id="skeleton-fats"></div>
                        <div class="macro-val" id="fats-val"><span id="fats-g">--</span>g</div>
                        <div class="skeleton skeleton-bar hidden" id="skeleton-fats-bar"></div>
                        <div class="macro-bar" id="fats-bar-container">
                            <div class="fill" style="width: 0%" id="fats-bar"></div>
                        </div>
                        <div class="macro-cal"><span id="fats-cals">--</span> kcal</div>
                    </div>
                </div>
            </section>

            <!-- 3D Body Composition Visualization (NEW) -->
            <section class="body3d-section glass-card" id="body3d-section">
                <div class="section-header">
                    <h2><i class="fa-solid fa-cube"></i> Composici√≥n Corporal 3D</h2>
                    <div class="body3d-controls">
                        <button type="button" class="btn-icon" id="rotate-toggle" title="Auto-rotaci√≥n">
                            <i class="fa-solid fa-rotate"></i>
                        </button>
                        <button type="button" class="btn-icon" id="reset-view" title="Resetear vista">
                            <i class="fa-solid fa-arrows-rotate"></i>
                        </button>
                    </div>
                </div>

                <div class="body3d-container">
                    <div class="body3d-canvas-wrapper" id="body3d-canvas-wrapper">
                        <!-- Three.js Canvas will be injected here or managed here -->
                        <canvas id="body3d-canvas"></canvas>
                        <div class="body3d-loader hidden" id="body3d-loader">
                            <i class="fa-solid fa-spinner fa-spin"></i>
                            <p>Generando modelo 3D...</p>
                        </div>
                    </div>

                    <div class="body3d-info">
                        <div class="composition-legend">
                            <h4>Leyenda de Composici√≥n</h4>
                            <div class="legend-item">
                                <span class="legend-color muscle"></span>
                                <div class="legend-text">
                                    <strong>Masa Magra</strong>
                                    <span id="lean-mass-percentage">--</span>%
                                </div>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color fat"></span>
                                <div class="legend-text">
                                    <strong>Grasa Corporal</strong>
                                    <span id="fat-mass-percentage">--</span>%
                                </div>
                            </div>
                        </div>

                        <div class="body3d-stats">
                            <div class="stat-item">
                                <i class="fa-solid fa-dumbbell"></i>
                                <div>
                                    <small>Masa Magra</small>
                                    <strong id="lean-mass-kg">-- kg</strong>
                                </div>
                            </div>
                            <div class="stat-item">
                                <i class="fa-solid fa-droplet"></i>
                                <div>
                                    <small>Grasa Corporal</small>
                                    <strong id="fat-mass-kg">-- kg</strong>
                                </div>
                            </div>
                        </div>

                        <div class="body3d-tip">
                            <i class="fa-solid fa-lightbulb"></i>
                            <p>Usa el mouse para rotar el modelo y explorar tu composici√≥n corporal en 3D. El modelo se
                                ajusta a tu % de grasa.</p>
                        </div>
                    </div>
                </div>
            </section>


            <!-- Time Projection Section (NEW) -->
            <section class="projection-section glass-card" id="projection-card" style="display: none;">
                <div class="projection-content">
                    <div class="projection-icon">
                        <i class="fa-solid fa-hourglass-half"></i>
                    </div>
                    <div class="projection-details">
                        <h3>Estimaci√≥n de Tiempo</h3>
                        <p class="projection-text">
                            Llegar√°s a tu meta de <span id="proj-weight" class="highlight-text">-- kg</span> en
                            aproximadamente
                            <span id="proj-weeks" class="highlight-gold">-- semanas</span>.
                        </p>
                        <p class="projection-date">Fecha estimada: <span id="proj-date">--/--/----</span></p>
                    </div>
                </div>
                <div class="projection-alert" id="proj-alert">
                    <i class="fa-solid fa-triangle-exclamation"></i>
                    <span>Ajusta tu objetivo para ver la proyecci√≥n.</span>
                </div>
            </section>

            <!-- Extras: Water & Details -->
            <section class="extras-grid">
                <!-- Water Card -->
                <div class="extra-card glass-card water-card">
                    <h3><i class="fa-solid fa-droplet"></i> Hidrataci√≥n</h3>
                    <div class="water-content">
                        <div class="water-glass">
                            <i class="fa-solid fa-glass-water"></i>
                        </div>
                        <div class="water-text">
                            <span class="water-val" id="water-output">-- L</span>
                            <span class="water-sub">Diarios recomendados</span>
                        </div>
                    </div>
                </div>

                <!-- Summary / Advice Card -->
                <div class="extra-card glass-card advice-card">
                    <h3><i class="fa-solid fa-lightbulb"></i> Recomendaci√≥n</h3>
                    <p id="advice-text">Completa tus datos para recibir una recomendaci√≥n personalizada basada en tu
                        objetivo.</p>
                </div>
            </section>
        </main>
    </div>
</body>

</html>